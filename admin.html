<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Haulify Admin Dashboard</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Firebase Authentication -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
    import {
      getFirestore, collection, getDocs
    } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";
    import {
      getAuth, onAuthStateChanged, signOut
    } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-auth.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCLSMAkt264osfGgJzjPFDYa3M7B9mI-n0",
      authDomain: "haulify-44786.firebaseapp.com",
      projectId: "haulify-44786",
      storageBucket: "haulify-44786.firebasestorage.app",
      messagingSenderId: "875772712436",
      appId: "1:875772712436:web:f6c4e21babde6cddecd5a1"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);

    
    // AUTH PROTECTION
    onAuthStateChanged(auth, (user) => {
      if (!user) {
        // redirect to login page
        window.location.href = "admin-login.html";
      } else {
        // load data only if logged in
        loadQuotes();
        loadContacts();
      }
    });


    // LOAD QUOTES
    async function loadQuotes() {
      const table = document.getElementById("quoteTableBody");
      table.innerHTML = "";

      const snapshot = await getDocs(collection(db, "quotes"));
      snapshot.forEach(doc => {
        let q = doc.data();
        table.innerHTML += `
          <tr>
            <td>${q.from}</td>
            <td>${q.to}</td>
            <td>${q.size}</td>
            <td>${q.timestamp?.toDate().toLocaleString() || ""}</td>
          </tr>`;
      });
    }

    // LOAD CONTACTS-
    async function loadContacts() {
      const table = document.getElementById("contactTableBody");
      table.innerHTML = "";

      const snapshot = await getDocs(collection(db, "contacts"));
      snapshot.forEach(doc => {
        let c = doc.data();
        table.innerHTML += `
          <tr>
            <td>${c.name}</td>
            <td>${c.email}</td>
            <td>${c.message}</td>
            <td>${c.timestamp?.toDate().toLocaleString() || ""}</td>
          </tr>`;
      });
    }

    // LOGOUT FUNCTION
    window.logout = function () {
      signOut(auth).then(() => {
        window.location.href = "admin-login.html";
      });
    };
  </script>

</head>

<body class="p-4">

  <h1 class="mb-4">Haulify Admin Dashboard</h1>

  <h2>Quotes</h2>
  <table class="table table-bordered mb-5">
    <thead>
      <tr>
        <th>From</th>
        <th>To</th>
        <th>Home Size</th>
        <th>Timestamp</th>
      </tr>
    </thead>
    <tbody id="quoteTableBody"></tbody>
  </table>

  <h2>Contacts</h2>
  <table class="table table-bordered">
    <thead>
      <tr>
        <th>Name</th>
        <th>Email</th>
        <th>Message</th>
        <th>Timestamp</th>
      </tr>
    </thead>
    <tbody id="contactTableBody"></tbody>
  </table>

  <button onclick="logout()" class="btn btn-danger mt-4">Logout</button>

</body>
</html>
